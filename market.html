<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AfyaSafe â€“ Marketplace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light" id="page">
  <main class="container py-4 d-flex flex-column align-items-center">
    <header class="w-100 mb-3 text-center" style="max-width:420px;">
      <h4 class="mt-2"><i class="bi bi-megaphone" style="color:#4caf50"></i> Marketplace</h4>
      <p class="small text-muted">Explore trusted offers, services, and community deals.</p>
    </header>

    <div class="w-100" style="max-width:420px;" id="market-ads">
      <div class="text-center text-muted">Loading ads...</div>
    </div>
  </main>

  <!-- Bottom Nav -->
  <nav class="navbar navbar-light bg-white shadow-lg fixed-bottom py-1">
    <div class="container-fluid justify-content-around">
      <a href="index.html" class="btn btn-link"><i class="bi bi-house fs-4" style="color:#c62828"></i></a>
      <a href="analytics.html" class="btn btn-link"><i class="bi bi-graph-up-arrow fs-4" style="color:#b87333"></i></a>
      <a href="learn.html" class="btn btn-link"><i class="bi bi-book fs-4" style="color:#4b2e2b"></i></a>
      <a href="market.html" class="btn btn-link active"><i class="bi bi-megaphone fs-4" style="color:#4caf50"></i></a>
      <a href="https://wa.me/233269609634" class="btn btn-link" target="_blank">
        <i class="bi bi-whatsapp fs-4" style="color:#25D366"></i>
      </a>
      <a href="index.html" class="btn btn-link">
        <img src="logo.png" alt="Logo" style="height:28px; width:auto; border-radius:50%;">
      </a>
    </div>
  </nav>

 <script>
  fetch('market.json')
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById('market-ads');
      container.innerHTML = '';

      const today = new Date();

      const activeAds = data.filter(ad => {
        if (!ad.start || !ad.duration) return true; // if no dates, always show

        const startDate = new Date(ad.start);
        const expiryDate = new Date(startDate);
        expiryDate.setDate(startDate.getDate() + ad.duration);

        return today >= startDate && today <= expiryDate;
      });

      if (activeAds.length === 0) {
        container.innerHTML = '<div class="alert alert-secondary text-center">No active ads at the moment.</div>';
        return;
      }

      activeAds.forEach(ad => {
        const card = document.createElement('div');
        card.className = 'card mb-3 shadow-sm';
        card.innerHTML = `
          <img src="${ad.image}" class="card-img-top" alt="${ad.title}">
          <div class="card-body">
            <h5 class="card-title">${ad.title}</h5>
            <p class="card-text">${ad.description}</p>
            <p class="card-text">${ad.cta}</p>
            <a href="${ad.whatsapp}" target="_blank" class="btn btn-success w-100">
              <i class="bi bi-whatsapp"></i> Join WhatsApp Group
            </a>
          </div>
        `;
        container.appendChild(card);
      });
    })
    .catch(err => {
      document.getElementById('market-ads').innerHTML = '<div class="alert alert-danger">Failed to load ads.</div>';
      console.error('Error loading ads:', err);
    });
</script>

</body>
</html>
